{"version":3,"sources":["../source/GitHubSDK.js"],"names":["PACKAGE","require","GitHubSDK","token","validate","error","urls","api","headers","Authorization","Accept","userAgent","version","props","owner","repo","path","message","content","branch","options","method","body","JSON","stringify","url","response","json","status","statusText","ok","name","org","description","homepage","keywordsList","keywords","Array","isArray","promises","map","searchForUser","keyword","Promise","all","encodeURIComponent","login"],"mappings":"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","file":"GitHubSDK.js","sourcesContent":["import 'babel-polyfill';\nimport Joi from 'joi';\nimport fetch from 'isomorphic-fetch';\nimport ErrorServerResponse from './ErrorServerResponse';\n\nimport keywordsSchema from './schema/keywordsSchema';\nimport constructorSchema from './schema/constructorSchema';\nimport uploadSchema from './schema/upload';\nimport createSchema from './schema/create';\nimport usersSchema from './schema/users';\nimport userSchema from './schema/user';\n\nconst PACKAGE = require('../package.json');\n\n/**\n * SDK for GitHub API\n *\n * @namespace GitHubSDK\n * @class\n * @param {string} token - github app token\n * @see https://developer.github.com/v3/\n */\nexport default class GitHubSDK {\n  /**\n   * Constructor, also save GitHub api token\n   * @param {string} token - github app token\n   */\n  constructor(token) {\n\n    Joi.validate(\n      token,\n      constructorSchema,\n      error => {\n        if (error !== null) throw error;\n      },\n    );\n\n    this.urls = {\n      api: 'https://api.github.com/',\n    };\n\n    this.headers = {\n      Authorization: `token ${token}`,\n      Accept: 'application/vnd.github.v3+json',\n      userAgent: `UserCrowler/${PACKAGE.version}`,\n      'Content-Type': 'application/json',\n    };\n  }\n\n  /**\n   * Uload file to repository\n   * @namespace GitHubSDK\n   * @method upload\n   *\n   * @throws {ValidationError}                    - Error of fields validation\n   * @throws {ErrorServerResponse}                - Server error\n   * @param  {Object}  props                      - upload props\n   * @param  {string}  props.owner                - organization or user name\n   * @param  {string}  props.repo                 - repository name\n   * @param  {string}  props.path                 - relative file path with file name in it\n   * @param  {string}  props.message              - commit message\n   * @param  {string}  props.content              - base64 encoded content\n   * @param  {string}  [props.branch='master']    - name of the branch\n   * @return {Promise<Content>}                   - uploaded content data\n   *\n   * @example <caption>Upload binary file</caption>\n   * import fs from 'fs';\n   * import GitHubSDK from '@frontender-magazine/github-sdk';\n   * (async()=>{\n   *   try {\n   *     const github = new GitHubSDK('b8f921864bd9a9fb6585b10e6534baa37c4d45fe');\n   *     const image = fs.readFileSync('/path/image.jpg', 'base64');\n   *     const content = await github.upload({\n   *       owner: 'FrontenderMagazine',\n   *       repo: 'article',\n   *       path: 'images/image.jpg',\n   *       message: 'Uploaded image.jpg',\n   *       content: image,\n   *     });\n   *   } catch (error) {\n   *     console.log(error.message);\n   *   }\n   * })();\n   *\n   * @example <caption>Upload text file</caption>\n   * import { Base64 } from 'js-base64';\n   * import GitHubSDK from '@frontender-magazine/github-sdk';\n   * (async()=>{\n   *   try {\n   *     const github = new GitHubSDK('b8f921864bd9a9fb6585b10e6534baa37c4d45fe');\n   *     const readme = Base64.btoa('# Title');\n   *     const content = await github.upload({\n   *       owner: 'FrontenderMagazine',\n   *       repo: 'article',\n   *       path: 'README.md',\n   *       message: 'Uploaded README.md',\n   *       content: readme,\n   *     });\n   *   } catch (error) {\n   *     console.log(error.message);\n   *   }\n   * })();\n   */\n  async upload(props) {\n\n    Joi.validate(\n      props,\n      uploadSchema,\n      error => {\n        if (error !== null) throw error;\n      },\n    );\n\n    const { owner, repo, path, message, content, branch } = props;\n\n    const options = {\n      method: 'PUT',\n      headers: this.headers,\n      body: JSON.stringify({\n        path,\n        message,\n        content,\n        branch,\n      }),\n    };\n\n    const url = `${this.urls.api}repos/${owner}/${repo}/contents/${path}`;\n    const response = await fetch(url, options);\n    let json;\n    try {\n      json = await response.json();\n    } catch (error) {\n      throw new ErrorServerResponse(response.status, response.statusText);\n    }\n    if (response.ok) return json;\n    throw new ErrorServerResponse(response.status, response.statusText, json);\n  }\n\n  /**\n   * Create repository in the organization\n   * @method create\n   *\n   * @throws {ValidationError}                        - Error of fields validation\n   * @throws {ErrorServerResponse}                    - Server error\n   * @param  {Object}  props                          - Options\n   * @param  {string}  props.name                     - Repository name\n   * @param  {string}  [props.description=null]       - Repository description\n   * @param  {string}  [props.homepage=null]          - Link to some related resourse\n   * @param  {string}  [props.org]                    - Organization name\n   * @return {Promise<Repository>}                    - Repository object\n   */\n  async create(props) {\n\n    Joi.validate(\n      props,\n      createSchema,\n      error => {\n        if (error !== null) throw error;\n      },\n    );\n\n    const { name, org, description, homepage } = props;\n\n    const options = {\n      method: 'POST',\n      headers: this.headers,\n      body: JSON.stringify({\n        name,\n        description,\n        homepage,\n      }),\n    };\n\n    const url = `${this.urls.api}orgs/${org}/repos`;\n    const response = await fetch(url, options);\n    let json;\n    try {\n      json = await response.json();\n    } catch (error) {\n      throw new ErrorServerResponse(response.status, response.statusText);\n    }\n    if (response.ok) return json;\n    throw new ErrorServerResponse(response.status, response.statusText, json);\n  }\n\n  /**\n   * Search for users\n   * @method searchForUsers\n   *\n   * @throws {ValidationError}     - Error of fields validation\n   * @throws {ErrorServerResponse} - Server error\n   * @param {Array<string>}        - Keywords\n   * @return {Promise<Users>}\n   */\n  searchForUsers(keywordsList) {\n\n    Joi.validate(\n      keywordsList,\n      keywordsSchema,\n      error => {\n        if (error !== null) throw error;\n      },\n    );\n\n    const keywords =\n      !Array.isArray(keywordsList) && typeof keywordsList === 'string'\n        ? new Array(keywordsList)\n        : keywordsList;\n    const promises = keywords.map(keyword => this.searchForUser(keyword));\n    return Promise.all(promises);\n  }\n\n  /**\n   * Search for user\n   * @method searchForUser\n   *\n   * @throws {ValidationError}     - Error of fields validation\n   * @throws {ErrorServerResponse} - Server error\n   * @param {String} keyword\n   * @return {Promise}\n   */\n  async searchForUser(keyword) {\n\n    Joi.validate(\n      keyword,\n      usersSchema,\n      error => {\n        if (error !== null) throw error;\n      },\n    );\n\n    const options = {\n      method: 'GET',\n      headers: this.headers,\n    };\n\n    const url = `${this.urls.api}search/users?q=${encodeURIComponent(keyword)}`;\n    const response = await fetch(url, options);\n    let json;\n    try {\n      json = await response.json();\n    } catch (error) {\n      throw new ErrorServerResponse(response.status, response.statusText);\n    }\n    if (response.ok) return json;\n    throw new ErrorServerResponse(response.status, response.statusText, json);\n  }\n\n  /**\n   * Get user details\n   * @method getUser\n   *\n   * @throws {ValidationError}     - Error of fields validation\n   * @throws {ErrorServerResponse} - Server error\n   * @param {String}               - login\n   * @return {Promise<User>}       — user representation\n   */\n  async getUser(login) {\n\n    Joi.validate(\n      login,\n      userSchema,\n      error => {\n        if (error !== null) throw error;\n      },\n    );\n\n    const options = {\n      method: 'GET',\n      headers: this.headers,\n    };\n\n    const url = `${this.urls.api}users/${encodeURIComponent(login)}`;\n    const response = await fetch(url, options);\n    let json;\n    try {\n      json = await response.json();\n    } catch (error) {\n      throw new ErrorServerResponse(response.status, response.statusText);\n    }\n    if (response.ok) return json;\n    throw new ErrorServerResponse(response.status, response.statusText, json);\n  }\n\n  /**\n   * Users object\n   *\n   * @namespace GitHubSDK\n   * @typedef {Users} - Users list representation\n   * @param {Array<User>} - Users list\n   */\n\n  /**\n   * User object\n   *\n   * @namespace GitHubSDK\n   * @typedef {User} User representation\n   * @see https://developer.github.com/v3/users/#response\n   */\n\n  /**\n   * Content object\n   *\n   * @namespace GitHubSDK\n   * @typedef {Content} Content representation\n   * @see https://developer.github.com/v3/repos/contents/#response-2\n   */\n\n  /**\n   * Repository object\n   *\n   * @namespace GitHubSDK\n   * @typedef {Repository} Repository representation\n   * @see https://developer.github.com/v3/repos/#response-2\n   */\n}\n"]}